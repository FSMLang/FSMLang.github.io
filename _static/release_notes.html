<html>
<head>
<title>FSMLang Release Notes</title>
<link rel="stylesheet" href="fsmlangweb.css"/>
</head>

<h1>FSMLang Release Notes</h1>

<body>
<table class="release_notes">

<tr>

	<th>Revision 2.2.1</th>
	<td>4 February 2026</td>
	<td>

		<p><i>runAppropriate...</i> functions are now correctly constructed when
		all states have entry functions or all states have exit functions.
		</p>

	</td>

</tr>

<tr>

	<th>Revision 2.2</th>
	<td>30 January 2026</td>
	<td>

		<p>Document comments placed on named entry and exit functions now appear in HTML and PlantUML output.
		</p>

		<p>Document comments in PlantUML output have their newlines escaped in certain display situations.
		</p>

		<p>PlantUML now only depicts one arrow for each path leaving a &lt;&lt;choice&gt;&gt; regardless of the
		number of entry paths.
		</p>

		<p>RST output can now be directed to reference a PlantUML source file rather than writing the PlantUML
		directly into the RST. See the usage discussion of --include-uml-objects.
		</p>

	</td>

</tr>

<tr>

	<th>Revision 2.1</th>
	<td>11 January 2026</td>
	<td>

		<p>Inclusion of files is now supported:
			<code>include subMachine.fsms</code>
		</p>
	

		<p>As with the C language preprosessor, the contents of the included file are
		treated exactly as if they were present in the including file, at the point of
		inclusion.  Thus, anything which would be legal to be present in an FSM file can
		be moved to a file to be included at that point.
		</p>

		<p>The use of a file extension other than <i>.fsm</i> is simply to not break gnu make
		suffix rules.
		</p>

		<p>Included files are listed as dependencies in the Makefile dependency rule.
		</p>

		<p>-c now works with -ts for machines with states returning events or void.  The effect
		is that no array of state functions is created; rather a pointer to the current
		state function is maintained.  This has implications for transition functions, which
		now must return a function pointer as well as the state enumeration (the state
		enumeration is still needed, sadly).
		</p>

		<p>The use of -c is vocally ignored with -tc for machines with actions returning other
		than events; and with -ts for machines with actions returning states.
		</p>

		<p>State functions now call their exit functions directly, rather than through
		<i>callAppropriateExitFunction</i>.
		</p>

		<p>Machines with state returning actions now work correctly with -ts.
		</p>

		<p>The output of -Md now first creates a rule specifying the dependence of the top-level output
		file on the fsm source and any files which that source includes. Next, a rule specifying that
		all other generated files depend on the top-level output file is created.  This was done to have
		suffix rules work correctly (they were not, in certain cases).
		</p>

	</td>
	
</tr>

<tr>
    <th>Revision 2.0</th>
    <td>9 November 2025</td>
    <td>

		<p> The code generated by this revision is not compatible with existing sub-
		machine data translators, nor any user action functions which invoke the
		event sharing functions.  The required change is small, and, a new
		convenience macro is provided to facilitate it.  See the comments on <i>-i</i>,
		below.
		</p>

		<p> Correct behavior of machines with actions returning states and void
		when machines have data.
		</p>

		<p> Introduce new keyword, <i>guard</i>, synonymous to <i>transition</i>
		when the transition is via a function.  This is consistent with UML
		usage.  HTML and PlantUML use <i>guard</i> rather than <i>transition</i>
		when the transition is via a function, regardless of the keyword used in
		the source.
		</p>

		<p> Fix -i.  -i0 correctly handles sub-machines. -ix where x &gt; 1 (2 and
		3 were tested) sets up additional run fuctions to specify which
		instance should be executed.  -i1 is the default and produces almost the
		same code as prior revisions.  The difference is that sub-machine data
		translation functions are now called with a pointer to the sub-machine
		as an argument.  New macros are provided to help with this. Data translation
		functions written for previous versions will need to be modified
		</p>

    </td>
</tr>

<tr>
    <th>Revision 1.47</th>
    <td>8 August 2025</td>
    <td>
		<p>Implement event sequence declarations.  These sequences do not affect C code
	   generation, but they are made part of the HTML, PlantUML and RST documentation.
		</p>
		<p>The goal is to provide an additional analysis aid for the understanding of 
		the state machine under construction.
		</p>
    </td>
</tr>

<tr>
    <th>Revision 1.46</th>
    <td>7 June 2025</td>
    <td>
		<p>Include <i>stdbool.h</i> when functions returning bool are generated.</p>
		<p>Add an option to include state enumerations in the cross reference only output.</p>
		<p>Create a full example of a hierarchical state machine.</p>
		<p>Do not share events in states which inhibit sub-machines. A new CL option,</p>
		<code>--inhibiting-states-share-events=&lt;*true|false&gt;</code>
		<p>has been added to preserve the previous behavior, which was to share events.</p>
    </td>
</tr>

<tr>
    <th>Revision 1.45.1</th>
    <td>15 March 2025</td>
    <td>
        <p>-Md and -Mh now only report files that are actually created.
        </p>

        <p>Empty &lt;name&gt;_events.h files are not created for sub-machines.
        </p>

    </td>
</tr>

<tr>
    <th>Revision 1.45.0</th>
    <td>18 February 2025</td>
    <td>
        <p>Implement --empty-cell-fn=<fn name> to allow user to designate a
	function to be called when the state machine encounters an empty
	event/state cell.
    </p>

        <p>-c now works with sub-machines.</p>

        <p>Not using --short-user-fn-names with sub-machines and -c now works.</p>

    </td>
</tr>

<tr>
    
    <th>Revision 1.44.1</th>
    <td>3 January 2025</td>
	
    <td>
    <p>Declaration and definition of machine structure is moved to _submach.h when necessary to
	support event sharing when machines involved have data.
    </p>
    </td>

</tr>

<tr>
    <th>Revision 1.44</th>
    <td>14 December 2024</td>
    <td>
        <p>New C language output variant creating an event-oriented array is provided.
        </p>

        <p>Most full tests now create each variant (event-state table, state array, and, event array).  In order to
        create identical output with each, "noAction" debug print statements have been added to the state and event array variants
        to match the those which were already present in the event-state table variant.
        </p>

        <p>The full tests which test all variants also have a <i>size</i> target producing a file of that name, containing the
        size of the image created by each variant.  New make include files, <i>variants.mk</i> and <i>create_target.mk</i>
        support the variant related targets.
        </p>

        <p>The FSM function may now be profiled.  See --add-profiling-macros and --profile-sub-fsms.
        </p>

        <p>PlantUML generation for the case that there is a single loopback for a state
        is correctly formatted.
        </p>

        <p>The HTML class for the first state no longer indicates that the state has no
        entry point.
        </p>

        <p>A new language output, reStructuredText, is now provided via the -tr option.
        </p>

        <p>It is now possible to indicate that a transition function will return "noTransition".
        </p>

        <p>Data blocks now support more than one level of indirection.
        </p>

        <p>The native impl block is now included in the source <i>before</i> the generated
        macros, thus preceding <i>any</i> generated code.
        </p>

    </td>
</tr>

<tr>
	<th>Revision 1.43.1</th>
	<td>17 July 2024</td>
	<td>
		<p>Correct exit code (0) now returned on successful operation when input files are not in the execution
		   directory.
		   </p>

		<p>Event cross reference only output now correctly includes <i>...noEvent</i> entries for sub-machines.
			</p>
	</td>
</tr>

	<th>Revision 1.43</th>
	<td>23 May 2024</td>
	<td>
        <p>C language event enumeration cross reference is now publishable to an external file, in
        any of three formats: json, csv, tab-delimited, and, XML. See the new command line options, <i>--event-cross-ref-only</i>
        and <i>--event-cross-ref-format</i>.
        </p>
	</td>
</tr>

<tr>
	<th>Revision 1.42</th>
	<td>15 February 2024</td>
	<td>
		<p>Multiple levels of sub-machines are now supported.</p>
		<p>Header files created has changed due to support of multiple sub-machine levels</p>
		<p>New CL option family, "-M, -Mh, -Md" added for exploitation of gnu make</p>
	</td>
</tr>

<tr>
	<th>Revision 1.41</th>
	<td>19 November 2023</td>
	<td>
		<p>New keywords, <span class="keyword">prologue</span> and <span class="keyword">epilogue</span> are provided.
		   These keywords modify <span class="keyword">native</span> and <span class="keyword">implementation</span>.
         <span class="keyword">epilogue</span> causes the block to be placed at the end of its respective file.
         <span class="keyword">prologue</span> is optional; blocks so modified are still placed at the beginning of 
         the respective files.
			</p>
	</td>
</tr>

<tr>
   <th>Revision 1.40</th>
   <td>6 September 2023</td>
   <td>
       <p>A run function is provided in addition to the RUN macro.</p>
       <p> Arbitrary plantuml code can be added, either as individual strings or files that will be copied, immediately after the opening @plantuml and before any FSMLang generated code.
       </p>
       <p> In switch machines, states which have no transitions will not contain code to invoke any "on transition" functions.
       </p>
       <p> A "cross-reference" giving the value and names of the event enumeration as a comment before the enumeration declaration may be requested.
       </p>
       <p>State functions now return correct types when events have data.</p>
       <p>Titles and legends may now be requested in plantuml output.</p>
	   </td>
</tr>

<tr>
   <th>Revision 1.39</th>
   <td>8 August 2023</td>
   <td>
      <p>Top-level events may now have associated data.</p>
   </td>
</tr>

<tr>
   <th>Revision 1.38</th>
   <td>10 May 2023</td>
   <td>
      <p>Bug which swapped named entry and exit functions fixed.</p>
   </td>
</tr>

<tr>
	<th>Revision 1.37</th>
	<td>11 April 2023</td>
  <td>
   <p>--add-machine-name can be used to have the machine name included when --short-debug-names is used.  The output is still reduced, since the machine name is included only once per line.
   </p>
   
   <p> Two macros are introduced: ACTION_RETURN_TYPE, which is defined as the return type for action functions; and, FSM_TYPE which is defined as the type of the machine.  These macros can be used to facilitate movement
     of action functions between sub-machines.
   </p>
   
   <p>Doc comments are now picked up when used with parent::
   </p>
 
   <p>
   A new keyword, "all" is added, which must appear in parentheses, to designate a state or event vector
     subsuming all events or states.
   </p>

    <p> States may now have entry and exit functions: <i>on (entry|exit) [function_name]</i> where [function_name] is optional.
    </p>

  </td>
</tr>

<tr>
	<th>Revision 1.36</th>
	<td>8 March 2023</td>
  <td>
   <p>braces can now appear inside of native and data blocks
   </p>
   
   <p>&lt;matrix&gt; <span class="keyword">transition</span> &lt;state&gt; is now legal as a transition only statement.
   </p>
   
   <p>transition statements appearing immediately after a sub-machine no longer cause an error.
   </p>
 
   <p>new command line option --force-generation-of-event-passing-actions forces the generation
   of event passing actions when weak function generation is inhibited.
   </p>

  </td>
</tr>

<tr>
	<th>Revision 1.35</th>
	<td>28 February 2023</td>
  <td>

   <p>added new option --short-debug-names to generate machine debug info without
   name prefix.
   </p>
 
   <p>Contributed by maintainer Daniel Jasinsky
   </p>

  </td>
</tr>

<tr>
	<th>Revision 1.34</th>
	<td>&nbsp;</td>
	<td>
		<p>1.34 was not released.
		</p>
	</td>
</tr>

<tr>
	<th>Revision 1.33</th>
	<td>19 February 2023</td>
	<td>
		<p>Fixed bug in PlantUML generation which resulted in malformed
      transitions when shared events are involved.
		</p>
 
		<p>Added "numAllEvents" macro to the top level event enumeration.
		</p>
	</td>
</tr>

<tr>
	<th>Revision 1.32</th>
	<td>10 February 2023</td>
	<td>
		<p>The macro EVENT_IS_NOT_EXCLUDED_FROM_LOG(e) can be used to exclude
   events from the main loop debug log.
		</p>
	</td>
</tr>

<tr>
	<th>Revision 1.31</th>
	<td>8 February 2023</td>
	<td>
    DECLARE_%s_MACHINE macro now correctly formed.
	</td>
</tr>

<tr>
	<th>Revision 1.30</th>
	<td>5 February 2023</td>
	<td>
    DECLARE_%s_MACHINE macro now correctly formed.
	</td>
</tr>

<tr>
	<th>Revision 1.29</th>
	<td>3 February 2023</td>
	<td>
      <p>Declare data translation functions in switch machines.</p>
      <p>Allow states to declare that sub-machines are to be inhibited therein.</p>
      <p>Put the current event into the FSM struct; this should not be used to make
      decisions (that's what the machine itself is for!), but for refined
      error reporting (or the like) in actions.</p>
	</td>
</tr>

<tr>
	<th>Revision 1.28</th>
	<td>2 February 2023</td>
	<td>
   EOLs which crept back into DBG_PRINTFs removed.
	</td>
</tr>

<tr>
	<th>Revision 1.27</th>
	<td>8 January 2023</td>
	<td>
  <p>
   Sub-machines can designate events as being shared from the parent machine.  Moreover, these events
    can designate data translation functions.  Code is generated to call the sub-machine whenever the parent experiences the event.  Any data translation function is called before the sub-machine is called.
    </p> 
    <p>
   A <span class="keyword">native impl(ementation)?</span> block can be defined in the machine qualifier section, analogous to the native block preceding the machine, the <i>native
     implementation</i> block is copied into the source file, rather than the header.
    </p>
	</td>
</tr>

<tr>
	<th>Revision 1.26</th>
	<td>19 December 2022</td>
	<td>
		RUN_STATE_MACHINE and DECLARE_xxx_MACHINE comply with MISRA C:2012:20.7
	</td>
</tr>

<tr>
	<th>Revision 1.25</th>
	<td>11 December 2022</td>
	<td>
		<p>The event-state table now scrolls when needed.
		</p>
		<p>--css-content-internal=true with -th option copies css content into the html file.  The default is to reference the styleshet externally.
		</p>

		<p>--css-content-filename=&lt;filename&gt; with -th option uses the indicated file for css content.
		</p>
	</td>
</tr>

<tr>
	<th>Revision 1.24</th>
	<td>8 December 2022</td>
	<td>
		<p>-tp option produces PlantUML output.</p>
		<p>--include-svg-img=true with -th option adds html image tag before event-state table.  The <i>src</i>
		attribute of the tag is set to [filename].svg.  The <i>alt</i> attribute is used to point out that
		the image must be generated separately.</p>
	</td>
</tr>

<tr>
	<th>Revision 1.23</th>
	<td>25 November 2022</td>
	<td>
		<p>enum typedefs C++ compliant.</p>
		<p>Sub-machine typedefs and declarations precede data block declaration.</p>
	</td>
</tr>

<tr>
	<th>Revision 1.22</th>
	<td>23 November 2022</td>
	<td><p>FSM_REVISION macro set the numeric fsm revision string now available.</p>
 
	</td>
</tr>

<tr>
	<th>Revision 1.21</th>
	<td>14 November 2022</td>
	<td><p>Sub-machines no longer have their own event enumerations; rather, all machines use one enumeration created at
   the top level.  This resolves warnings generated by armcc.  Convenience macros are provided for referencing
   the right enumeration.
	 </p>
 
   <p>Sub-machines no longer generate unnecessary state transition function declarations.
   </p>
	</td>
</tr>

<tr>
	<th>Revision 1.20</th>
	<td>20 October 2022</td>
	<td>--core-logging-only=true suppresses the generation of debug logging outside of the core fsm function.
	</td>
</tr>

<tr>
   <th>Revision 1.19</th>
	<td>7 September 2022</td>
   <td>--generate-weak-fns=false suppresses the generation of weak function stubs.
   </td>
</tr>

<tr>
   <th>Revision 1.18</th>
	<td>31 August 2022</td>
   <td>findAndRunSubMachine not declared when no sub-machines are present.
   </td>
</tr>

<tr>
   <th>Revision 1.17</th>
	<td>29 August 2022</td>
   <td>Data initialization is mediated through a macro.
   </td>
</tr>

<tr>
   <th>Revision 1.16</th>
	<td>28 August 2022</td>
   <td>C Switch Machines now generate any sub-machines.
   </td>
</tr>

<tr>
   <th>Revision 1.15</th>
	<td>24 August 2022</td>
   <td>Compact table generation correctly references states and state transition functions.
   </td>
</tr>

<tr>
   <th>Revision 1.14</th>
	<td>16 August 2023</td>
   <td>returns statements with multiple entries can now end with a namespace event reference.
   </td>
</tr>

<tr>
   <th>Revision 1.13</th>
	<td>16 August 2023</td>
   <td>RUN_STATE_MACHINE and DECLARE_%s_MACHINE now enclose parameters in parentheses. 
   </td>
</tr>

<tr>
   <th>Revision 1.12</th>
	<td>15 August 2023</td>
   <td>"Action returns" statements can now reference sub-machine events 
   and "parent" events.
   </td>
</tr>

<tr>
   <th>Revision 1.11</th>
	<td>12 August 2022</td>
   <td>Remove line-endings from generated DBG_PRINTF statements.
   </td>
</tr>

<tr>
   <th>Revision 1.10</th>
	<td>7 August 2022</td>
   <td>Create weakly linked stubs for all user functions.  Cygwin
   seems to have trouble with this.  It works for Mingwsa. Have
   not tested Linux.
   </td>
</tr>

<tr>
   <th>Revision 1.9</th>
	<td>6 August 2022</td>
   <td>Removed the concept of an "active" sub state machine; all sub-machines can
   run based on the event given to the top level machine.
   </td>
</tr>

<tr>
   <th>Revision 1.8</th>
	<td>23 July 2022</td>
    <td>introduces Hierarchical state machines.
   </td>
</tr>

<tr>
   <th>Revision 1.7</th>
	<td>13 July 2021</td>
   <td>
			<ul>
      <li>introduces the concept of transition functions to machines having actions which return states.</li>
      <li>extends the -c option to machines having actions which return void.  This required no code changes.</li>
      <li>introduces a new machine qualifier: 'on transition ID;' where ID names a function which will be called</li>
        whenever the state changes.  The function takes a pointer to the machine, and the value of the new state.</li>
   </td>
</tr>

<tr>
   <th>Revision 1.6</th>
	<td>28 January 2020</td>
   <td>adds a new command line option, -c, which will create a more compact event/state table.  The option is
   currently only meaningful when -tc is used with machines having actions which return events.
 
   <p>Compaction is achieved by creating a table of pointers to the action functions along with an enum to index it.  This enum
   and the state enum are used to create the event/state table basic type; and, the enums are declared with the packed
   attribute.  Thus, for machines having less than 256 actions and states, the size of the basic event/state table type struct
   is only 2 bytes.
   </p>
 
   <p>When transition functions are used, a similar table/enum pair is constructed.
   </p>
   </td>
</tr>

<tr>
   <th>Revision 1.5</th>
	<td>&nbsp;</td>
   <td>adds a new output type modifier, 's'.  Specifying -ts will create a machine in which each state is
      handled by a function, which switches on the event to execute the appropriate action function and select the
      next state.  This type of machine uses no memory, as there is no event/state table; the machine is
      purely code.
 
      <p>Also, the "actions return states" machine is fixed.
      </p>
   </td>
</tr>

<tr>
   <th>Revision 1.4</th>
	<td>&nbsp;</td>
   <td>adds two new functions:
      <ul>
      <li>transitions may now be done through functions, rather than designated states.  As with actions, these
        are not previously declared; they are simply stated.  The function arguments are first a pointer to the
        machine, followed by the event causing the transition.
        </li>
      <li>both actions and transitions may be given return declarations.  These are in the form of "name returns ...;"
        where "name" is a previously seen action or transition function name.  Presently, this information is used
        only to enhance the HTML page.
        </li>
      </ul>
   </td>
</tr>

<tr>
   <th>Revision 1.3</th>
	<td>&nbsp;</td>
   <td>quiets a warning about  the shadowing of a global variable by a local variable; the warning
   was correct, but the shadowing was not consequential.  In the spirit of "no warnings are the only good warnings"....
   </td>
</tr>

<tr>
   <th>Revision 1.2</th>
	<td>&nbsp;</td>
   <td>adds a new option: "-i0" will inhibit the creation of an instance of the machine.
   Any other argument to -i, or not having -i0 will cause the creation of an instance, which is
   the historical behavior.
   </td>
</tr>

<tr> 
  <th>Revision 1.1</th>
	<td>&nbsp;</td>
  <td> separates the action/transition array from the machine structure.  Two
  benefits proceed from this: first, the array can be made constant; and second, the machine
  structure can now be instantiated multiple times.  A macro is provided by which machines may
  be easily declared.
  </td>
</tr> 

</tr>

</table>
</body>
</html>
